{"pageProps":{"source":{"compiledSource":"var m=Object.defineProperty,N=Object.defineProperties;var d=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var r=(e,n,s)=>n in e?m(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,a=(e,n)=>{for(var s in n||(n={}))o.call(n,s)&&r(e,s,n[s]);if(p)for(var s of p(n))c.call(n,s)&&r(e,s,n[s]);return e},i=(e,n)=>N(e,d(n));var l=(e,n)=>{var s={};for(var t in e)o.call(e,t)&&n.indexOf(t)<0&&(s[t]=e[t]);if(e!=null&&p)for(var t of p(e))n.indexOf(t)<0&&c.call(e,t)&&(s[t]=e[t]);return s};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var t=s,{components:e}=t,n=l(t,[\"components\"]);return mdx(MDXLayout,i(a(a({},layoutProps),n),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",null,\"Efficient asset management is crucial for maintaining optimal build times in iOS development. Asset catalogs (\",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\") are central to this process, but default behaviors in tools like CocoaPods can lead to unnecessary recompilation, slowing down your development cycle.\"),mdx(\"p\",null,\"In this post, I'll delve into how asset catalogs are handled during the build process, the inefficiencies introduced by CocoaPods' default resource packaging logic, and how to optimize this process to achieve significantly faster incremental builds.\"),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"understanding-asset-catalogs-and-cocoapods\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#understanding-asset-catalogs-and-cocoapods\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Understanding Asset Catalogs and CocoaPods\"),mdx(\"h3\",a({},{id:\"what-are-asset-catalogs\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#what-are-asset-catalogs\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"What Are Asset Catalogs?\"),mdx(\"p\",null,\"Asset catalogs (\",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\") are collections of assets such as images, icons, and colors used in an iOS application. During the build process, these catalogs are compiled into a binary-optimized format using a tool called \",mdx(\"inlineCode\",{parentName:\"p\"},\"actool\"),\". This compilation ensures that assets are efficiently packaged for the app.\"),mdx(\"h3\",a({},{id:\"the-role-of-actool\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#the-role-of-actool\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"The Role of \",mdx(\"inlineCode\",{parentName:\"h3\"},\"actool\")),mdx(\"p\",null,mdx(\"inlineCode\",{parentName:\"p\"},\"actool\"),\" is a command-line utility provided by Xcode that compiles asset catalogs into a format that the app can use at runtime. It also handles the extraction of the app's main icon during the build phase.\"),mdx(\"h3\",a({},{id:\"asset-catalog-compilation\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#asset-catalog-compilation\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Asset Catalog Compilation\"),mdx(\"p\",null,\"If an application has multiple asset catalogs, \",mdx(\"inlineCode\",{parentName:\"p\"},\"actool\"),\" compiles them together into a single binary asset catalog embedded in the application. This process is crucial for the app to access its assets efficiently.\"),mdx(\"h3\",a({},{id:\"how-cocoapods-handles-resources\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#how-cocoapods-handles-resources\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"How CocoaPods Handles Resources\"),mdx(\"p\",null,mdx(\"a\",a({parentName:\"p\"},{href:\"https://cocoapods.org/\"}),\"CocoaPods\"),\" is a dependency management system for Swift and Objective-C projects. It simplifies integrating third-party libraries into your app. When dealing with resources, CocoaPods must manage packages (pods) that provide assets, sometimes compiling them into bundles or including them directly in the main application's asset catalog.\"),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"the-problem-inefficient-asset-catalog-compilation\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#the-problem-inefficient-asset-catalog-compilation\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"The Problem: Inefficient Asset Catalog Compilation\"),mdx(\"h3\",a({},{id:\"default-resource-packaging-logic\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#default-resource-packaging-logic\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Default Resource Packaging Logic\"),mdx(\"p\",null,\"CocoaPods generates a resource copy script named \",mdx(\"inlineCode\",{parentName:\"p\"},\"Pods-<Target_Name>-resources.sh\"),\" for each target. This script is called on every build and contains logic to package resources from dependencies. However, this logic is minimal and introduces inefficiencies, particularly with asset catalogs.\"),mdx(\"h3\",a({},{id:\"recompilation-on-every-build\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#recompilation-on-every-build\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Recompilation on Every Build\"),mdx(\"p\",null,\"By default, CocoaPods lacks logic to prevent recompiling the asset catalog when the original resources haven't changed. Consequently, the asset catalog is rebuilt on every build, including incremental ones where no assets have been modified. This unnecessary recompilation increases build times and reduces productivity.\"),mdx(\"h3\",a({},{id:\"redundancy-in-resource-packaging\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#redundancy-in-resource-packaging\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Redundancy in Resource Packaging\"),mdx(\"p\",null,\"The default packaging logic has double redundancy:\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Always Recompiling the Binary Asset Catalog\"),\": Regardless of changes, the asset catalog is compiled every time.\"),mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Packaging Resources Twice\"),\": Resources are included both in the bundles for local modules and again in the main module.\")),mdx(\"h3\",a({},{id:\"naming-collisions\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#naming-collisions\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Naming Collisions\"),mdx(\"p\",null,\"Asset catalogs share a global naming domain. If assets in different catalogs have the same name, the final binary asset catalog can only include one of them, leading to undefined behavior regarding which asset is used.\"),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"a-practical-example\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#a-practical-example\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"A Practical Example\"),mdx(\"p\",null,\"Consider the following folder structure:\"),mdx(\"pre\",null,mdx(\"code\",a({parentName:\"pre\"},{}),`root_folder\n|-- ExternalModules\n|   |-- Module1\n|   |   |-- Assets.xcassets\n|   |-- Module2\n|   |   |-- Assets.xcassets\n|   |-- Module3\n|   |   |-- Assets.xcassets\n|-- Sources\n|   |-- resources\n|   |   |-- Assets.xcassets\n`)),mdx(\"h3\",a({},{id:\"initial-resource-collection\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#initial-resource-collection\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Initial Resource Collection\"),mdx(\"p\",null,\"Initially, resources are collected via the \",mdx(\"inlineCode\",{parentName:\"p\"},\"install_resource\"),\" bash function in the resource copy script. Notice how the contents of the \",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\" catalogs are listed as individual files:\"),mdx(\"pre\",a({},{className:\"language-bash\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-bash\"}),\"install_resource \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets/info-icon-blue.imageset/Contents.json\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets/info-icon.imageset/Contents.json\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets/shopping-power-icon1.imageset/Contents.json\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets/shopping-power-icon2.imageset/Contents.json\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets/shopping-power-icon3.imageset/Contents.json\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Localizable/ar.lproj/Localizable.strings\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Localizable/en.lproj/Localizable.strings\"'),`\ninstall_resource `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'/../ExternalModules/SpendingLimit/Sources/SpendingLimit/Resources/Assets.xcassets\"'),`\n`)),mdx(\"p\",null,\"The call to \",mdx(\"inlineCode\",{parentName:\"p\"},\"install_resource\"),\" with an \",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\" argument stores the asset in the \",mdx(\"inlineCode\",{parentName:\"p\"},\"XCASSET_FILES\"),\" array.\"),mdx(\"h3\",a({},{id:\"cocoapods-resource-copy-script\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#cocoapods-resource-copy-script\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"CocoaPods Resource Copy Script\"),mdx(\"p\",null,\"At the end of the script, CocoaPods scans for all \",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\" files\\u2014even those not included in the packages:\"),mdx(\"pre\",a({},{className:\"language-bash\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" -n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${WRAPPER_EXTENSION}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"`\"),\"xcrun --find actool\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"`\")),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" -n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${XCASSET_FILES\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\":-\"),\"}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Find all other xcassets (this unfortunately includes those of path pods and other targets).\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"OTHER_XCASSETS\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"find\"),\" -L \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token environment constant\"}),\"$PWD\"),'\"'),\" -iname \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"*.xcassets\"'),\" -type d\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"while\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" line\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"do\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),\"$line\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"!=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PODS_ROOT}\"),'*\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n      `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"XCASSET_FILES\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"+=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$line\"),'\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"done\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"<<<\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$OTHER_XCASSETS\"),'\"'),`\n\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" -z \",mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),\"${ASSETCATALOG_COMPILER_APPICON_NAME+x}\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"printf\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"%s',mdx(\"span\",a({parentName:\"span\"},{className:\"token entity\",title:\"\\\\0\"}),\"\\\\0\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${XCASSET_FILES\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"[\"),\"@\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"]\"),\"}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"xargs\"),\" -0 xcrun actool \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --output-format human-readable-text --notices --warnings `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --platform `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PLATFORM_NAME}\"),'\"'),\" --minimum-deployment-target \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"!\"),\"DEPLOYMENT_TARGET_SETTING_NAME}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),\"${TARGET_DEVICE_ARGS}\"),\" --compress-pngs \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --compile `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${BUILT_PRODUCTS_DIR}\"),\"/\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${UNLOCALIZED_RESOURCES_FOLDER_PATH}\"),'\"'),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"else\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"printf\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"%s',mdx(\"span\",a({parentName:\"span\"},{className:\"token entity\",title:\"\\\\0\"}),\"\\\\0\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${XCASSET_FILES\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"[\"),\"@\",mdx(\"span\",a({parentName:\"span\"},{className:\"token punctuation\"}),\"]\"),\"}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token function\"}),\"xargs\"),\" -0 xcrun actool \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --output-format human-readable-text --notices --warnings `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --platform `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${PLATFORM_NAME}\"),'\"'),\" --minimum-deployment-target \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${\",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"!\"),\"DEPLOYMENT_TARGET_SETTING_NAME}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),\"${TARGET_DEVICE_ARGS}\"),\" --compress-pngs \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --compile `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${BUILT_PRODUCTS_DIR}\"),\"/\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${UNLOCALIZED_RESOURCES_FOLDER_PATH}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --app-icon `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${ASSETCATALOG_COMPILER_APPICON_NAME}\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),`\n    --output-partial-info-plist `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${TARGET_TEMP_DIR}\"),'/assetcatalog_generated_info_cocoapods.plist\"'),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n`)),mdx(\"p\",null,\"In this script:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"CocoaPods tries to predict which \",mdx(\"inlineCode\",{parentName:\"li\"},\".xcassets\"),\" belong to the current project by scanning all folders.\"),mdx(\"li\",{parentName:\"ul\"},\"There's no logic to prevent rebuilding if assets haven't changed.\"),mdx(\"li\",{parentName:\"ul\"},\"The script doesn't discern between assets belonging to different targets, leading to redundancy and potential naming collisions.\")),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"the-solution-optimizing-asset-catalog-compilation\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#the-solution-optimizing-asset-catalog-compilation\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"The Solution: Optimizing Asset Catalog Compilation\"),mdx(\"p\",null,\"To address these inefficiencies, we can modify the resource copy script to prevent unnecessary recompilation and reduce redundancy.\"),mdx(\"h3\",a({},{id:\"overview-of-optimizations\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#overview-of-optimizations\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Overview of Optimizations\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Check if Asset Catalogs Have Changed\"),\": Use an external script to determine if recompilation is necessary.\"),mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Ensure App Icon Extraction\"),\": Even if assets haven't changed, the app icon must still be exported.\"),mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Ignore Assets from External Modules\"),\": Exclude \",mdx(\"inlineCode\",{parentName:\"li\"},\".xcassets\"),\" from \",mdx(\"inlineCode\",{parentName:\"li\"},\"ExternalModules\"),\" to avoid redundancy.\"),mdx(\"li\",{parentName:\"ol\"},mdx(\"strong\",{parentName:\"li\"},\"Modify Search Paths\"),\": Search for \",mdx(\"inlineCode\",{parentName:\"li\"},\".xcassets\"),\" only in the main \",mdx(\"inlineCode\",{parentName:\"li\"},\"Sources\"),\" folder.\")),mdx(\"h3\",a({},{id:\"step-1-checking-for-asset-changes\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#step-1-checking-for-asset-changes\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Step 1: Checking for Asset Changes\"),mdx(\"p\",null,\"I introduce an external script \",mdx(\"inlineCode\",{parentName:\"p\"},\"Scripts/check_xcassets_changed.sh\"),\" that checks whether the asset catalogs have changed since the last build. This script uses \",mdx(\"inlineCode\",{parentName:\"p\"},\"mtree\"),\", a macOS tool that creates a checksum of a directory.\"),mdx(\"h4\",a({},{id:\"scriptscheck_xcassets_changedsh-script\"}),mdx(\"a\",a({parentName:\"h4\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#scriptscheck_xcassets_changedsh-script\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),mdx(\"inlineCode\",{parentName:\"h4\"},\"Scripts/check_xcassets_changed.sh\"),\" Script\"),mdx(\"pre\",a({},{className:\"language-bash\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"any_mtree_created\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),`false\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Locate all xcassets files\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"for\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token for-or-select variable\"}),\"fn\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"in\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"`\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"find\"),\" -L \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token environment constant\"}),\"$PWD\"),'\"'),\" -path \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token environment constant\"}),\"$PWD\"),'/ExternalModules/*.xcassets\"'),\" -o -path \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token environment constant\"}),\"$PWD\"),'/Sources/*.xcassets\"'),\" -type d\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"`\")),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"do\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Checking ',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"sha\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token builtin class-name\"}),\"echo\"),\" -n \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" shasum -a \",mdx(\"span\",a({parentName:\"span\"},{className:\"token number\"}),\"256\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"head\"),\" -c \",mdx(\"span\",a({parentName:\"span\"},{className:\"token number\"}),\"40\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"filename\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$(\"),mdx(\"span\",a({parentName:\"span\"},{className:\"token function\"}),\"basename\"),\" -- \",mdx(\"span\",a({parentName:\"span\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\")\")),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"mtreefile\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"${BUILT_PRODUCTS_DIR}\"),\"/.mtree.\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$sha\"),\".\",mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$filename\"),'\"'),`\n    \n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Check if checksum file exists\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"!\"),\" -f \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$mtreefile\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Creating snapshot for ',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'...\"'),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Create checksum file\"),`\n        mtree -c -K sha256digest -p `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$mtreefile\"),'\"'),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token assign-left variable\"}),\"any_mtree_created\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),`true\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"else\"),` \n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Comparing ',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'...\"'),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Compare existing tree against the checksum file\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"!\"),\" mtree -f \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$mtreefile\"),'\"'),\" -K sha256digest -p \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Changes detected in ',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Recreate the checksum\"),`\n            mtree -c -K sha256digest -p `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$fn\"),'\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\">\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",a({parentName:\"span\"},{className:\"token variable\"}),\"$mtreefile\"),'\"'),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"exit\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"done\"),`\n\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token variable\"}),\"$any_mtree_created\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"==\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token boolean\"}),\"true\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"New mtree files created, indicating change\"'),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin class-name\"}),\"exit\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token number\"}),\"1\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"fi\"),`\n`)),mdx(\"p\",null,\"This script:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Finds all \",mdx(\"inlineCode\",{parentName:\"li\"},\".xcassets\"),\" files belonging to the main target.\"),mdx(\"li\",{parentName:\"ul\"},\"Generates or updates checksum files for each asset catalog.\"),mdx(\"li\",{parentName:\"ul\"},\"Determines whether recompilation is necessary based on checksum comparisons.\")),mdx(\"h3\",a({},{id:\"step-2-ensuring-app-icon-extraction\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#step-2-ensuring-app-icon-extraction\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Step 2: Ensuring App Icon Extraction\"),mdx(\"p\",null,\"Even if the asset catalogs haven't changed, we need to ensure that the app icon is correctly exported. We modify the script to handle this separately.\"),mdx(\"h3\",a({},{id:\"step-3-ignoring-external-module-assets\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#step-3-ignoring-external-module-assets\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Step 3: Ignoring External Module Assets\"),mdx(\"p\",null,\"We adjust the script to ignore \",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\" from the \",mdx(\"inlineCode\",{parentName:\"p\"},\"ExternalModules\"),\" folder, as they are included in the bundles for local dependencies, avoiding redundancy and naming collisions.\"),mdx(\"h3\",a({},{id:\"step-4-modifying-search-paths\"}),mdx(\"a\",a({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#step-4-modifying-search-paths\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Step 4: Modifying Search Paths\"),mdx(\"p\",null,\"We modify the search paths in the script to look for \",mdx(\"inlineCode\",{parentName:\"p\"},\".xcassets\"),\" only in the main \",mdx(\"inlineCode\",{parentName:\"p\"},\"Sources\"),\" folder, excluding unnecessary directories.\"),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"patching-the-resource-copy-script\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#patching-the-resource-copy-script\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Patching the Resource Copy Script\"),mdx(\"p\",null,\"We apply the optimizations directly to the \",mdx(\"inlineCode\",{parentName:\"p\"},\"Pods-<Target_Name>-resources.sh\"),\" script during the execution of the \",mdx(\"inlineCode\",{parentName:\"p\"},\"pod install\"),\" command. The code to patch the script is as follows:\"),mdx(\"pre\",a({},{className:\"language-ruby\"}),mdx(\"code\",a({parentName:\"pre\"},{className:\"language-ruby\"}),mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),'# Patch \"*-resources.sh\" scripts to include optimized xcassets caching logic'),`\nresources_sh_files `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\"installer_representation\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"sandbox\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"root\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"join\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Target Support Files/Pods-<TARGET NAME>/Pods-<TARGET NAME>-resources.sh\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`\nputs `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Patching *-resources.sh scripts\"'),`\n\nresources_sh_files`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"each\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"do\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\"resources_sh_file\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),`\n    script `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"File\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"read\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"resources_sh_file\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token builtin\"}),\"File\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"open\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"resources_sh_file\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),\"'w'\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"do\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\"f\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"|\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Step 1: Insert the script to check if asset catalog recompilation is necessary\"),`\n        script `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" script\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"gsub\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\\'if [[ -n \"${WRAPPER_EXTENSION}\" ]] && [ \"`xcrun --find actool`\" ] && [ -n \"${XCASSET_FILES:-}\" ]\\''),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            '`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"!\"),\" sh \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"${PODS_ROOT}/../Scripts/check_xcassets_changed.sh\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"then\"),`\n    echo `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"XCAssets changed, processing...\"'),`\n                \n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"if\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"-\"),\"n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"${WRAPPER_EXTENSION}\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"`xcrun --find actool`\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"-\"),\"n \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"${XCASSET_FILES:-}\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),`'\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Step 2: Insert the logic to update app icon\"),`\n        script `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" script\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"gsub\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            'assetcatalog_generated_info_cocoapods`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`plist\"\n  fi\nfi'`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            'assetcatalog_generated_info_cocoapods`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),`plist\"\n  fi\nfi\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"else\"),`\n    echo `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"XCAssets not changed, skipping...\"'),`\nfi\n                \n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"/\"),\"usr\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"/\"),\"libexec\",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"/\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token constant\"}),\"PlistBuddy\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"-\"),\"x \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"-\"),\"c \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`\"Merge \\\\'\\${TARGET_TEMP_DIR}/assetcatalog_generated_info_cocoapods.plist\\\\'\"`),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"${BUILT_PRODUCTS_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}/Info.plist\"'),`'\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Step 3: Skip xcassets from modules\"),`\n        script `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" script\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"gsub\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            'install_resource`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\"'\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            'install_resource`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),`\n  `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"[\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"$1\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"==\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"ExternalModules\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"$1\"'),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"==\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"*\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"xcassets \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"]\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"&&\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"{\"),\" echo \",mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Skipping $1\"'),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"return\"),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\";\"),\" \",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"}\"),`'\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token comment\"}),\"# Step 4: Search for assets in Sources\"),`\n        script `,mdx(\"span\",a({parentName:\"code\"},{className:\"token operator\"}),\"=\"),\" script\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"gsub\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`'OTHER_XCASSETS=$(find -L \"$PWD\" -iname \"*.xcassets\" -type d)'`),mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\",\"),`\n            `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),`'OTHER_XCASSETS=$(find -L \"\\${PODS_ROOT}/../Sources/\" -iname \"*.xcassets\" -type d)'`),`\n        `,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        f`,mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\".\"),\"puts\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"script\",mdx(\"span\",a({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),`\n        puts `,mdx(\"span\",a({parentName:\"code\"},{className:\"token string\"}),'\"Patched ',mdx(\"span\",a({parentName:\"span\"},{className:\"token interpolation\"}),mdx(\"span\",a({parentName:\"span\"},{className:\"token delimiter tag\"}),\"#{\"),\"resources_sh_file\",mdx(\"span\",a({parentName:\"span\"},{className:\"token delimiter tag\"}),\"}\")),'\"'),`\n    `,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"end\"),`\n`,mdx(\"span\",a({parentName:\"code\"},{className:\"token keyword\"}),\"end\"),`\n`)),mdx(\"p\",null,\"This code:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Step 1\"),\": Inserts the check for asset changes using the external script.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Step 2\"),\": Ensures the app icon is updated even if assets haven't changed.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Step 3\"),\": Skips \",mdx(\"inlineCode\",{parentName:\"li\"},\".xcassets\"),\" from \",mdx(\"inlineCode\",{parentName:\"li\"},\"ExternalModules\"),\" during resource installation.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Step 4\"),\": Adjusts the search path to include only the main \",mdx(\"inlineCode\",{parentName:\"li\"},\"Sources\"),\" folder.\")),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"results-and-benefits\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#results-and-benefits\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Results and Benefits\"),mdx(\"p\",null,\"Implementing these optimizations led to significant improvements:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Reduced Rebuild Time\"),\": Build times decreased from \",mdx(\"strong\",{parentName:\"li\"},\"20 seconds\"),\" to \",mdx(\"strong\",{parentName:\"li\"},\"8 seconds\"),\" for incremental builds.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"No Impact on CI Builds\"),\": Continuous Integration (CI) builds remain unaffected since they build the app from scratch each time.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Avoided Naming Collisions\"),\": By excluding assets from \",mdx(\"inlineCode\",{parentName:\"li\"},\"ExternalModules\"),\", we reduced the risk of naming collisions in the final binary asset catalog.\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"Streamlined Asset Compilation\"),\": Only necessary assets are compiled, enhancing efficiency.\")),mdx(\"hr\",null),mdx(\"h2\",a({},{id:\"conclusion\"}),mdx(\"a\",a({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#conclusion\"}),mdx(\"span\",a({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Conclusion\"),mdx(\"p\",null,\"Optimizing asset catalog compilation in your iOS projects can lead to substantial improvements in build times and developer productivity. By customizing the resource copy script generated by CocoaPods and implementing a mechanism to detect changes in assets, we can prevent unnecessary recompilation and eliminate redundancy.\"),mdx(\"p\",null,\"If you're experiencing long build times due to asset catalog compilation, consider implementing these optimizations. Not only will you save time, but you'll also create a more efficient and maintainable build process.\"),mdx(\"hr\",null),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"References:\")),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://guides.cocoapods.org/\"}),\"CocoaPods Official Documentation\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://developer.apple.com/library/archive/documentation/Xcode/Reference/xcode_ref-Asset_Catalog_Format/\"}),\"Apple Developer Documentation on Asset Catalogs\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",a({parentName:\"li\"},{href:\"https://www.freebsd.org/cgi/man.cgi?mtree(8)\"}),\"mtree Utility Manual\")),mdx(\"li\",{parentName:\"ul\"},\"Photo by \",mdx(\"a\",{href:\"https://unsplash.com/@erol?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\"},\"Erol Ahmed\"),\" on \",mdx(\"a\",{href:\"https://unsplash.com/photos/close-up-photography-of-brown-wooden-card-catalog-Y3KEBQlB1Zk?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash\"},\"Unsplash\"))))}MDXContent.isMDXComponent=!0;\n","scope":{"title":"Optimizing Asset Catalog Compilation in CocoaPods for Faster iOS Builds","description":"Efficient asset management is crucial for maintaining optimal build times in iOS development. Asset catalogs (`.xcassets`) are central to this process, but default behaviors in tools like CocoaPods can lead to unnecessary recompilation, slowing down your development cycle.","date":"2024-11-01","image":"/images/catalog.jpg","published":true}},"frontMatter":{"title":"Optimizing Asset Catalog Compilation in CocoaPods for Faster iOS Builds","description":"Efficient asset management is crucial for maintaining optimal build times in iOS development. Asset catalogs (`.xcassets`) are central to this process, but default behaviors in tools like CocoaPods can lead to unnecessary recompilation, slowing down your development cycle.","date":"2024-11-01","image":"/images/catalog.jpg","published":true}},"__N_SSG":true}