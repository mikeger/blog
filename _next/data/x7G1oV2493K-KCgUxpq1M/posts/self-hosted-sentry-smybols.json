{"pageProps":{"source":{"compiledSource":"var l=Object.defineProperty,d=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var o=Object.getOwnPropertySymbols;var r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var p=(a,t,s)=>t in a?l(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,e=(a,t)=>{for(var s in t||(t={}))r.call(t,s)&&p(a,s,t[s]);if(o)for(var s of o(t))i.call(t,s)&&p(a,s,t[s]);return a},c=(a,t)=>d(a,h(t));var m=(a,t)=>{var s={};for(var n in a)r.call(a,n)&&t.indexOf(n)<0&&(s[n]=a[n]);if(a!=null&&o)for(var n of o(a))t.indexOf(n)<0&&i.call(a,n)&&(s[n]=a[n]);return s};const makeShortcode=a=>function(s){return console.warn(\"Component \"+a+\" was not imported, exported, or provided by MDXProvider as global scope\"),mdx(\"div\",e({},s))},Image=makeShortcode(\"Image\"),layoutProps={},MDXLayout=\"wrapper\";function MDXContent(s){var n=s,{components:a}=n,t=m(n,[\"components\"]);return mdx(MDXLayout,c(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(Image,{alt:\"Sentry\",src:\"/images/sentry-symbols/sentry.svg\",width:720,height:540,priority:!0,mdxType:\"Image\"}),mdx(\"h3\",e({},{id:\"introduction\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#introduction\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Introduction\"),mdx(\"p\",null,\"Sentry is an application performance and error tracking tool. It is available as a SaaS product and can be self-hosted. Sentry can be used to track errors and crashes in mobile applications. Sentry can also be used to track performance metrics such as memory usage, CPU usage, and network usage.\"),mdx(\"p\",null,\"In this article, we will go through the steps required to set up a self-hosted Sentry for system frames de-symbolication on iOS. \"),mdx(\"p\",null,\"People use self-hosted Sentry to have it fine tuned for their needs and to have more control over the data. Additionally, it can be cheaper to run self-hosted Sentry than to use the SaaS product.\"),mdx(\"p\",null,\"Cloud-based Sentry has the system symbols available for de-symbolication. However, self-hosted Sentry does not have the system symbols available. This article will show you how to set up self-hosted Sentry to de-symbolicate the system frames.\"),mdx(\"p\",null,\"This core building block is in my opinion required for any self-hosted Sentry instance. It allows you to see the method names of the system frameworks in your stack traces.\"),mdx(\"p\",null,\"Default self-hosted Sentry allows you to de-symbolicate the frames in the application code. However, it does not allow you to de-symbolicate the frames in the system frameworks. This is because the system frameworks are not part of the application bundle. They are part of the operating system, and they are different for different operating system releases.\"),mdx(\"h3\",e({},{id:\"prerequisites\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#prerequisites\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Prerequisites\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Running self-hosted Sentry instance\"),mdx(\"li\",{parentName:\"ul\"},\"S3 bucket to store the de-symbolication information\")),mdx(\"h3\",e({},{id:\"what-is-de-symbolication\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#what-is-de-symbolication\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"What is de-symbolication\"),mdx(\"p\",null,\"When an application is crashing, the operating system collects the stack trace of the crash. The stack trace contains the addresses of the methods that were executed when the crash happened. The stack trace is then sent to Sentry. Sentry then tries to de-symbolicate the stack trace. De-symbolication is the process of converting the addresses to method names. This allows you to see the method names in the stack trace.\"),mdx(\"p\",null,\"For your application, Xcode is creating a mapping file that maps the addresses to the method names. This mapping file is then uploaded to Sentry. When Sentry receives a crash report, it uses the mapping file to de-symbolicate the stack trace.\"),mdx(\"p\",null,\"For the system frameworks, there is no mapping file. The system frameworks are part of the operating system.\"),mdx(Image,{alt:\"Symbolicated crash: symbols for UIKit are missing\",src:\"/images/sentry-symbols/not-symbolicated.png\",width:1404,height:196,priority:!0,mdxType:\"Image\"}),mdx(\"h3\",e({},{id:\"how-sentry-is-de-symbolicating-crashes\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#how-sentry-is-de-symbolicating-crashes\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"How Sentry is de-symbolicating crashes\"),mdx(\"p\",null,\"Sentry is using a special service called \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/getsentry/symbolicator\"}),\"Symbolicator\"),\" to de-symbolicate the stack traces. Symbolicator is a standalone service that can be run independently from Sentry. It is also possible to run Symbolicator as a part of Sentry. In this article, we will be running Symbolicator as a part of Sentry.\"),mdx(\"h2\",e({},{id:\"setting-it-up\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#setting-it-up\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Setting it up\"),mdx(\"h3\",e({},{id:\"procuring-the-system-frameworks\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#procuring-the-system-frameworks\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Procuring the system frameworks\"),mdx(\"p\",null,\"I could not find any official way to download the system frameworks. It is possible to acquire them using Xcode. If you connect a device running a certain iOS version to your computer, Xcode is going to fetch the system frameworks to your machine (in \",mdx(\"inlineCode\",{parentName:\"p\"},\"/Library/Developer/Xcode/iOS\\\\ DeviceSupport\"),\"). However, I found a \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/CXTretar/iOS-System-Symbols-Supplement\"}),\"GitHub repository\"),\" that contains the system frameworks for iOS 12. I downloaded the repository and extracted the system frameworks from it.\"),mdx(\"p\",null,\"I am unaware of the licensing implications of copying the system symbols, but I think it is fine unless you are not distributing them. I hope eventually there would be a public repository that engineers could access.\"),mdx(Image,{alt:\"A lot of archived symbols downloading\",src:\"/images/sentry-symbols/download.png\",width:506,height:556,priority:!0,mdxType:\"Image\"}),mdx(\"p\",null,\"The total size of all symbols for iOS 12 to iOS 16.3 is about 60 gigabytes, so you might need to empty your Derived Data folder before downloading and unarchiving them.\"),mdx(\"h3\",e({},{id:\"sorting-symbols-to-a-unified-format\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#sorting-symbols-to-a-unified-format\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Sorting symbols to a unified format\"),mdx(\"p\",null,\"Sentry created a special tool to sort existing OS-provided symbol information into a unified format. This tool is called \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/getsentry/symbolicator/tree/master/crates/symsorter\"}),\"symsorter\"),\". It is a Rust binary that can be compiled and run on your machine. \"),mdx(\"h4\",e({},{id:\"building-sorter\"}),mdx(\"a\",e({parentName:\"h4\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#building-sorter\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Building Sorter\"),mdx(\"p\",null,\"You need to have Rust installed on your machine. You can install Rust using \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://brew.sh\"}),\"homebrew\"),\":\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),\"brew \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"install\"),` rust\n`)),mdx(\"p\",null,\"Then you need to check out the symbolicator repository:\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"git\"),` clone git@github.com:getsentry/symbolicator.git\n`)),mdx(\"p\",null,\"Once you have Rust installed, you can build the symsorter binary by running the following command:\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"cd\"),` symbolicator/crates/symsorter\ncargo build --release\n`)),mdx(\"p\",null,\"This will create a binary in \",mdx(\"inlineCode\",{parentName:\"p\"},\"symbolicator/target/release/symsorter\"),\". You can copy it to your path or run it from the current directory.\"),mdx(\"h3\",e({},{id:\"sorting\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#sorting\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Sorting\"),mdx(\"p\",null,\"In order to sort symbols, you need to create an empty folder on your local machine, for example \",mdx(\"inlineCode\",{parentName:\"p\"},\"~/ios_symbols\"),\".\"),mdx(\"p\",null,\"Then you need to run the following command:\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),\"symbolicator/target/release/symsorter -zz -o ~/ios_symbols --prefix ios --bundle-id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"16.3\"),\".1-arm64e ~/Downloads/16.3.1\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"(\"),\"20D67\",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\")\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"\\\\\"),` arm64e\n`)),mdx(\"p\",null,\"You need to run it for every symbol file you have. In my case, I have a whopping 129 symbol files. I have created a bash script to run the command for every symbol file:\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"token shebang important\"}),\"#!/bin/bash\"),`\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"find\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\".\"),\" -type d -maxdepth \",mdx(\"span\",e({parentName:\"code\"},{className:\"token number\"}),\"1\"),\" -print0 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"while\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"read\"),\" -d $\",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),\"'\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\0\"}),\"\\\\0\"),\"'\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"file\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"do\"),`\n `,mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"Processing ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$file\"),'\"'),`\n `,mdx(\"span\",e({parentName:\"code\"},{className:\"token assign-left variable\"}),\"path\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token operator\"}),\"=\"),mdx(\"span\",e({parentName:\"code\"},{className:\"token variable\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"`\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token builtin class-name\"}),\"echo\"),\" $file \",mdx(\"span\",e({parentName:\"span\"},{className:\"token operator\"}),\"|\"),\" \",mdx(\"span\",e({parentName:\"span\"},{className:\"token function\"}),\"sed\"),\" -E \",mdx(\"span\",e({parentName:\"span\"},{className:\"token string\"}),\"'s/^\\\\.\\\\/([0-9\\\\.]*) \\\\(([A-Z0-9]*)\\\\) ?(arm64.)?/\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\1\"}),\"\\\\1\"),\"-\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\2\"}),\"\\\\2\"),\"-\",mdx(\"span\",e({parentName:\"span\"},{className:\"token entity\",title:\"\\\\3\"}),\"\\\\3\"),\"/'\"),mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"`\")),`\n `,mdx(\"span\",e({parentName:\"code\"},{className:\"token builtin class-name\"}),\"echo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"path: ',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$path\"),'\"'),`\n\n `,mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\"/symbolicator/target/release/symsorter -zz -o \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),\"/sorted_symbols --prefix ios --bundle-id \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$path\"),'\"'),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token string\"}),'\"',mdx(\"span\",e({parentName:\"span\"},{className:\"token variable\"}),\"$file\"),'\"'),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"token keyword\"}),\"done\"),`\n`)),mdx(\"p\",null,\"You run this script in the folder where you have extracted the system frameworks. It will create a folder called \",mdx(\"inlineCode\",{parentName:\"p\"},\"sorted_symbols\"),\" with the sorted symbols. This would take a while, and your CPU would do Brrr.\"),mdx(Image,{alt:\"CPU load using symbolicator: Brrrr\",src:\"/images/sentry-symbols/brrr.png\",width:269,height:467,priority:!0,mdxType:\"Image\"}),mdx(\"h3\",e({},{id:\"uploading-symbols-to-s3\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#uploading-symbols-to-s3\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Uploading symbols to S3\"),mdx(\"p\",null,\"As mentioned above, you need to provide an S3 bucket to host the sorted symbols. You can create an S3 bucket using the AWS console.\"),mdx(\"p\",null,\"Then you need to upload the sorted symbols to the S3 bucket. You can use the AWS console or the AWS CLI. I have used the AWS CLI to upload the symbols:\"),mdx(\"pre\",e({},{className:\"language-bash\"}),mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),\"aws s3 \",mdx(\"span\",e({parentName:\"code\"},{className:\"token function\"}),\"sync\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"token punctuation\"}),\"..\"),`/sorted_symbols s3://sentry-symbols/\n`)),mdx(\"h3\",e({},{id:\"configuring-sentry-to-use-the-symbols\"}),mdx(\"a\",e({parentName:\"h3\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#configuring-sentry-to-use-the-symbols\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Configuring Sentry to use the symbols\"),mdx(\"p\",null,\"In order to configure yout Sentry instance to use the symbols you need to open your project preferences (open your project -> Cogwheel on the right) and go to the Processing -> Debug Files section.\"),mdx(\"p\",null,'Then in Custom repositories select \"Add Repository\" and enter the needed information:'),mdx(Image,{alt:\"Configuration\",src:\"/images/sentry-symbols/configuration.png\",width:1354,height:2010,priority:!0,mdxType:\"Image\"}),mdx(\"h2\",e({},{id:\"conclusion\"}),mdx(\"a\",e({parentName:\"h2\"},{\"aria-hidden\":\"true\",tabIndex:-1,href:\"#conclusion\"}),mdx(\"span\",e({parentName:\"a\"},{className:\"icon icon-link\"}))),\"Conclusion\"),mdx(Image,{alt:\"Voila\",src:\"/images/sentry-symbols/voila.png\",width:1346,height:244,priority:!0,mdxType:\"Image\"}),mdx(\"p\",null,\"Nice, now you can see the method names of the system frameworks in your stack traces. This is a great step towards better crash reports. \"),mdx(\"p\",null,\"NB: As Apple is going to release new iOS versions going forward, there would be a need to add new symbols to the S3 bucket. I am not sure how to automate this process, but I am sure it is possible. Most of the time it would be possible to collect the new symbols by updating your phone to the latest iOS version and connecting it to Xcode.\"),mdx(\"p\",null,\"I hope this article was helpful. If you have any questions, feel free to reach out to me on Twitter: \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://twitter.com/gk0io\"}),\"@gk0io\"),\".\"))}MDXContent.isMDXComponent=!0;\n","scope":{"title":"Self-Hosted Sentry: iOS system frames de-symbolication","description":"How to set up self-hosted Sentry for system frames de-symbolication on iOS.","date":"2023-04-03","image":"/images/sentry-symbols/sentry.svg","published":true}},"frontMatter":{"title":"Self-Hosted Sentry: iOS system frames de-symbolication","description":"How to set up self-hosted Sentry for system frames de-symbolication on iOS.","date":"2023-04-03","image":"/images/sentry-symbols/sentry.svg","published":true}},"__N_SSG":true}